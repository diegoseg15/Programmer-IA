<form class="chat-container" [formGroup]="chatForm" (ngSubmit)="onSubmit()">
  <div class="chat-header">
    <h5 class="chat-title">Chat</h5>
    <select class="chat-select" formControlName="modelo">
      <option value="" disabled selected>Elige modelo</option>
      <option *ngFor="let modelo of modelos" [value]="modelo">
        {{ modelo }}
      </option>
    </select>
  </div>

  <div class="chat-body">
    <div *ngIf="error" class="chat-error">{{ error }}</div>

    <div *ngFor="let msg of messages"
      [ngClass]="{ 'chat-user-message': msg.role === 'user', 'chat-user-assistant': msg.role === 'assistant' }">
      <div [ngClass]="{ 'chat-user-bubble': msg.role === 'user', 'chat-assistant-bubble': msg.role === 'assistant' }">
        <span class="chat-label">
          {{ msg.role === 'user' ? 'Usuario' : 'Asistente' }}
        </span>
        <div [innerHTML]="msg.role === 'assistant' 
          ? (parsedResponse?.mensaje ? parseMarkdown(parsedResponse.mensaje) : parseMarkdown(msg.content))
          : parseMarkdown(msg.content)">
        </div>
      </div>
    </div>
  </div>


  <div class="chat-form" [formGroup]="chatForm">
    <textarea name="contenido" rows="2" formControlName="mensaje" placeholder="Escribe un mensaje..."
      class="chat-input"></textarea>
    <button type="submit" class="chat-button">Enviar</button>
  </div>
</form>